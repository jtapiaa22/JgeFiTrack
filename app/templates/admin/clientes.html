{% extends "base.html" %}
{% block contenido %}

<div class="container mt-4">
  <!-- ====== TÍTULO Y BOTÓN ====== -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary fw-bold mb-0">
      <i class="bi bi-people-fill me-2"></i> Clientes Registrados
    </h2>
    <a href="{{ url_for('admin.nuevo_cliente') }}" class="btn btn-success shadow-sm">
      <i class="bi bi-person-plus"></i> Nuevo Cliente
    </a>
  </div>

  {% if clientes %}
  <!-- ====== TABLA DE CLIENTES ====== -->
  <div class="card border-0">
    <div class="table-responsive rounded-3 shadow-sm">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="text-center">
          <tr>
            <th style="width: 5%;">#</th>
            <th style="width: 35%;">Nombre de Usuario</th>
            <th style="width: 20%;">Total Alumnos</th>
            <th style="width: 20%;">Total Mediciones</th>
            <th style="width: 20%;">Acciones</th>
          </tr>
        </thead>

        <tbody>
          {% for c in clientes %}
          <tr class="text-center">
            <td class="fw-semibold text-secondary">{{ loop.index }}</td>
            <td class="fw-semibold text-capitalize">{{ c.username }}</td>
            <td>{{ c.total_alumnos }}</td>
            <td>{{ c.total_mediciones }}</td>

            <!-- ====== ACCIONES ====== -->
            <td>
              <div class="d-flex justify-content-center gap-2">

                <!-- Ver -->
                <a href="{{ url_for('admin.ver_cliente', cliente_id=c.id) }}"
                  class="btn btn-sm shadow-sm text-light" id="btn-ver"
                  title="Ver Cliente" data-bs-toggle="tooltip">
                  <i class="bi bi-eye"></i>
                </a>

                <!-- Editar -->
                <a href="{{ url_for('admin.editar_cliente', cliente_id=c.id) }}"
                  class="btn btn-sm shadow-sm text-dark" id="btn-editar"
                  title="Editar Cliente" data-bs-toggle="tooltip">
                  <i class="bi bi-pencil-square"></i>
                </a>

                <!-- Registrar Pago -->
                <form action="{{ url_for('admin.registrar_pago', cliente_id=c.id) }}"
                      method="post" class="d-inline" title="Registrar Pago" data-bs-toggle="tooltip">
                  <button type="submit" class="btn btn-sm shadow-sm text-dark" id="btn-pago">
                    <i class="bi bi-cash"></i>
                  </button>
                </form>

                <!-- Eliminar -->
                <form action="{{ url_for('admin.eliminar_cliente', cliente_id=c.id) }}"
                      method="POST" class="d-inline"
                      onsubmit="return confirm('¿Eliminar este cliente definitivamente?')"
                      title="Eliminar Cliente" data-bs-toggle="tooltip">
                  <button type="submit" class="btn btn-sm shadow-sm text-light" id="btn-eliminar">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>

              </div>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% else %}
  <!-- ====== MENSAJE SI NO HAY CLIENTES ====== -->
  <div class="alert alert-info mt-4 text-center shadow-sm">
    <i class="bi bi-info-circle me-2"></i> No hay clientes registrados aún.
  </div>
  {% endif %}
</div>

<!-- Activar tooltips de Bootstrap -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(t => new bootstrap.Tooltip(t));
  });
</script>

{% endblock %}
